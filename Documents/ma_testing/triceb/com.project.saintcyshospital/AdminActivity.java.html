<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdminActivity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">com.project.saintcyshospital</a> &gt; <span class="el_source">AdminActivity.java</span></div><h1>AdminActivity.java</h1><pre class="source lang-java linenums">package com.project.saintcyshospital;

import android.app.AlertDialog;
import android.os.Bundle;
import android.text.InputType;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.Spinner;
import android.widget.TextView;
import android.widget.Toast;

import androidx.appcompat.app.AppCompatActivity;
import androidx.core.view.ViewCompat;

import com.android.volley.DefaultRetryPolicy;
import com.android.volley.Request;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.JsonObjectRequest;
import com.android.volley.toolbox.StringRequest;
import com.google.android.material.bottomnavigation.BottomNavigationView;

import org.json.JSONException;
import org.json.JSONObject;

<span class="nc" id="L28">public class AdminActivity extends BaseActivity {</span>
    private static final String URL_USER_CREATE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/admin/user&quot;;
    private static final String URL_USER_READ_BY_USERNAME_BASE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/admin/user/&quot;;
    private static final String URL_USER_UPDATE_BASE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/admin/user/&quot;;
    private static final String URL_USER_DELETE_BASE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/admin/user/&quot;;

    private static final String URL_MED_CREATE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/admin/products&quot;;
    private static final String URL_MED_READ_BASE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/admin/products/&quot;;
    private static final String URL_MED_UPDATE_BASE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/admin/products/&quot;;
    private static final String URL_MED_DELETE_BASE = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/notification/products/&quot;;

    private static final String URL_BROADCAST = &quot;https://gwenda-gentling-discomfortably.ngrok-free.dev/api/notifications/broadcast&quot;;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="nc" id="L44">        super.onCreate(savedInstanceState);</span>
<span class="nc" id="L45">        setContentView(R.layout.activity_admin);</span>
<span class="nc" id="L46">        setupBottomNav(0);</span>

<span class="nc" id="L48">        BottomNavigationView bottomNav = findViewById(R.id.bottomNav);</span>

<span class="nc" id="L50">        ViewCompat.setOnApplyWindowInsetsListener(bottomNav, (view, insets) -&gt; {</span>
<span class="nc" id="L51">            int left = view.getPaddingLeft();</span>
<span class="nc" id="L52">            int top = view.getPaddingTop();</span>
<span class="nc" id="L53">            int right = view.getPaddingRight();</span>

<span class="nc" id="L55">            view.setPadding(left, top, right, 0);</span>
<span class="nc" id="L56">            return insets;</span>
        });

<span class="nc" id="L59">        Button uCreate = findViewById(R.id.btnUserCreate);</span>
<span class="nc" id="L60">        Button uRead   = findViewById(R.id.btnUserRead);</span>
<span class="nc" id="L61">        Button uUpdate = findViewById(R.id.btnUserUpdate);</span>
<span class="nc" id="L62">        Button uDelete = findViewById(R.id.btnUserDelete);</span>

<span class="nc" id="L64">        Button mCreate = findViewById(R.id.btnMedCreate);</span>
<span class="nc" id="L65">        Button mRead   = findViewById(R.id.btnMedRead);</span>
<span class="nc" id="L66">        Button mUpdate = findViewById(R.id.btnMedUpdate);</span>
<span class="nc" id="L67">        Button mDelete = findViewById(R.id.btnMedDelete);</span>

<span class="nc" id="L69">        Button bcast = findViewById(R.id.btnBroadcast);</span>


<span class="nc" id="L72">        uCreate.setOnClickListener(v -&gt; promptUserCreate());</span>
<span class="nc" id="L73">        uRead.setOnClickListener(v -&gt; promptUserRead());</span>
<span class="nc" id="L74">        uUpdate.setOnClickListener(v -&gt; promptUserUpdate());</span>
<span class="nc" id="L75">        uDelete.setOnClickListener(v -&gt; promptUserDelete());</span>

<span class="nc" id="L77">        mCreate.setOnClickListener(v -&gt; promptMedCreate());</span>
<span class="nc" id="L78">        mRead.setOnClickListener(v -&gt; promptMedRead());</span>
<span class="nc" id="L79">        mUpdate.setOnClickListener(v -&gt; promptMedUpdate());</span>
<span class="nc" id="L80">        mDelete.setOnClickListener(v -&gt; promptMedDelete());</span>

<span class="nc" id="L82">        bcast.setOnClickListener(v -&gt; promptBroadcast());</span>
<span class="nc" id="L83">    }</span>

    private LinearLayout formLayout() {
<span class="nc" id="L86">        LinearLayout root = new LinearLayout(this);</span>
<span class="nc" id="L87">        root.setOrientation(LinearLayout.VERTICAL);</span>
<span class="nc" id="L88">        int pad = (int) (16 * getResources().getDisplayMetrics().density);</span>
<span class="nc" id="L89">        root.setPadding(pad, pad, pad, pad / 2);</span>
<span class="nc" id="L90">        root.setLayoutParams(new LinearLayout.LayoutParams(</span>
                ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT));
<span class="nc" id="L92">        return root;</span>
    }

    private EditText addField(LinearLayout parent, String hint, int inputType) {
<span class="nc" id="L96">        EditText e = new EditText(this);</span>
<span class="nc" id="L97">        e.setHint(hint);</span>
<span class="nc" id="L98">        e.setInputType(inputType);</span>
<span class="nc" id="L99">        parent.addView(e);</span>
<span class="nc" id="L100">        return e;</span>
    }

    private Spinner addRoleSpinner(LinearLayout parent) {
<span class="nc" id="L104">        Spinner s = new Spinner(this);</span>
<span class="nc" id="L105">        String[] roles = new String[] { &quot;PATIENT&quot;, &quot;DOCTOR&quot;, &quot;ADMIN&quot;, &quot;PHARMACIST&quot;};</span>
<span class="nc" id="L106">        ArrayAdapter&lt;String&gt; aa = new ArrayAdapter&lt;&gt;(this, android.R.layout.simple_spinner_item, roles);</span>
<span class="nc" id="L107">        aa.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span class="nc" id="L108">        s.setAdapter(aa);</span>
<span class="nc" id="L109">        parent.addView(s);</span>
<span class="nc" id="L110">        return s;</span>
    }

    private void applyDevRetryPolicy(com.android.volley.Request&lt;?&gt; req) {
<span class="nc" id="L114">        req.setRetryPolicy(new DefaultRetryPolicy(5000, 1, 1f));</span>
<span class="nc" id="L115">    }</span>

    private void promptUserCreate() {
<span class="nc" id="L118">        LinearLayout f = formLayout();</span>
<span class="nc" id="L119">        EditText email    = addField(f, &quot;Email&quot;, InputType.TYPE_TEXT_VARIATION_EMAIL_ADDRESS);</span>
<span class="nc" id="L120">        EditText username = addField(f, &quot;Username&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L121">        Spinner  role     = addRoleSpinner(f);</span>
<span class="nc" id="L122">        EditText pass     = addField(f, &quot;Password&quot;, InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_PASSWORD);</span>

<span class="nc" id="L124">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L125">                .setTitle(&quot;Create User&quot;)</span>
<span class="nc" id="L126">                .setView(f)</span>
<span class="nc" id="L127">                .setPositiveButton(&quot;Create&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L128">                    JSONObject body = new JSONObject();</span>
                    try {
<span class="nc" id="L130">                        body.put(&quot;email&quot;, email.getText().toString().trim());</span>
<span class="nc" id="L131">                        body.put(&quot;username&quot;, username.getText().toString().trim());</span>
<span class="nc" id="L132">                        body.put(&quot;role&quot;, role.getSelectedItem().toString());</span>
<span class="nc" id="L133">                        body.put(&quot;password&quot;, pass.getText().toString());</span>
<span class="nc" id="L134">                    } catch (JSONException ignored) {}</span>

<span class="nc" id="L136">                    JsonObjectRequest req = new JsonObjectRequest(</span>
                            Request.Method.POST,
                            URL_USER_CREATE,
                            body,
<span class="nc" id="L140">                            resp -&gt; showJson(&quot;User Created&quot;, resp.toString()),</span>
<span class="nc" id="L141">                            (VolleyError err) -&gt; toast(&quot;Create user failed&quot;)</span>
                    );
<span class="nc" id="L143">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L144">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L145">                })</span>
<span class="nc" id="L146">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L147">                .show();</span>
<span class="nc" id="L148">    }</span>

    private void promptUserRead() {
<span class="nc" id="L151">        LinearLayout f = formLayout();</span>
<span class="nc" id="L152">        EditText username = addField(f, &quot;Username&quot;, android.text.InputType.TYPE_CLASS_TEXT);</span>

<span class="nc" id="L154">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L155">                .setTitle(&quot;Read User by Username&quot;)</span>
<span class="nc" id="L156">                .setView(f)</span>
<span class="nc" id="L157">                .setPositiveButton(&quot;Fetch&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L158">                    String u = username.getText().toString().trim();</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">                    if (u.isEmpty()) { toast(&quot;Enter a username&quot;); return; }</span>

                    // Encode path segment
<span class="nc" id="L162">                    String url = URL_USER_READ_BY_USERNAME_BASE + android.net.Uri.encode(u);</span>

<span class="nc" id="L164">                    com.android.volley.toolbox.JsonObjectRequest req =</span>
                            new com.android.volley.toolbox.JsonObjectRequest(
                                    com.android.volley.Request.Method.GET,
                                    url,
                                    null,
<span class="nc" id="L169">                                    resp -&gt; showJson(&quot;User&quot;, resp.toString()),</span>
<span class="nc" id="L170">                                    (com.android.volley.VolleyError err) -&gt; toast(&quot;Read user failed&quot;)</span>
                            );
<span class="nc" id="L172">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L173">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L174">                })</span>
<span class="nc" id="L175">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L176">                .show();</span>
<span class="nc" id="L177">    }</span>

    private void promptUserUpdate() {
<span class="nc" id="L180">        LinearLayout f = formLayout();</span>
<span class="nc" id="L181">        EditText id       = addField(f, &quot;User ID&quot;, InputType.TYPE_CLASS_NUMBER);</span>
<span class="nc" id="L182">        EditText email    = addField(f, &quot;New Email (optional)&quot;, InputType.TYPE_TEXT_VARIATION_EMAIL_ADDRESS);</span>
<span class="nc" id="L183">        EditText username = addField(f, &quot;New Username (optional)&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L184">        Spinner  role     = addRoleSpinner(f);</span>

<span class="nc" id="L186">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L187">                .setTitle(&quot;Update User&quot;)</span>
<span class="nc" id="L188">                .setView(f)</span>
<span class="nc" id="L189">                .setPositiveButton(&quot;Update&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L190">                    JSONObject body = new JSONObject();</span>
                    try {
<span class="nc bnc" id="L192" title="All 2 branches missed.">                        if (!email.getText().toString().trim().isEmpty())</span>
<span class="nc" id="L193">                            body.put(&quot;email&quot;, email.getText().toString().trim());</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">                        if (!username.getText().toString().trim().isEmpty())</span>
<span class="nc" id="L195">                            body.put(&quot;username&quot;, username.getText().toString().trim());</span>
<span class="nc" id="L196">                        body.put(&quot;role&quot;, role.getSelectedItem().toString());</span>
<span class="nc" id="L197">                    } catch (JSONException ignored) {}</span>

<span class="nc" id="L199">                    String url = URL_USER_UPDATE_BASE + id.getText().toString().trim();</span>

<span class="nc" id="L201">                    JsonObjectRequest req = new JsonObjectRequest(</span>
                            Request.Method.PUT,
                            url,
                            body,
<span class="nc" id="L205">                            resp -&gt; showJson(&quot;User updated&quot;, resp.toString()),</span>
<span class="nc" id="L206">                            (VolleyError err) -&gt; toast(&quot;Update user failed&quot;)</span>
                    );
<span class="nc" id="L208">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L209">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L210">                })</span>
<span class="nc" id="L211">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L212">                .show();</span>
<span class="nc" id="L213">    }</span>

    private void promptUserDelete() {
<span class="nc" id="L216">        LinearLayout f = formLayout();</span>
<span class="nc" id="L217">        EditText id = addField(f, &quot;User ID&quot;, InputType.TYPE_CLASS_NUMBER);</span>

<span class="nc" id="L219">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L220">                .setTitle(&quot;Delete User&quot;)</span>
<span class="nc" id="L221">                .setView(f)</span>
<span class="nc" id="L222">                .setPositiveButton(&quot;Delete&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L223">                    String url = URL_USER_DELETE_BASE + id.getText().toString().trim();</span>

<span class="nc" id="L225">                    StringRequest req = new StringRequest(</span>
                            Request.Method.DELETE,
                            url,
<span class="nc" id="L228">                            resp -&gt; toast(&quot;User deleted&quot;),</span>
<span class="nc" id="L229">                            (VolleyError err) -&gt; toast(&quot;Delete user failed&quot;)</span>
                    );
<span class="nc" id="L231">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L232">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L233">                })</span>
<span class="nc" id="L234">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L235">                .show();</span>
<span class="nc" id="L236">    }</span>

    private void promptMedCreate() {
<span class="nc" id="L239">        LinearLayout f = formLayout();</span>
<span class="nc" id="L240">        EditText name    = addField(f, &quot;Drug Name&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L241">        EditText generic = addField(f, &quot;Generic Name&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L242">        EditText dosage  = addField(f, &quot;Dosage (e.g., 10 mg)&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L243">        EditText price   = addField(f, &quot;Price (cents, e.g., 1299)&quot;, InputType.TYPE_CLASS_NUMBER);</span>
<span class="nc" id="L244">        EditText image   = addField(f, &quot;Image URL (optional)&quot;, InputType.TYPE_TEXT_VARIATION_URI);</span>

<span class="nc" id="L246">        TextView protectedLabel = new TextView(this);</span>
<span class="nc" id="L247">        protectedLabel.setText(&quot;Protected Status:&quot;);</span>
<span class="nc" id="L248">        protectedLabel.setTextSize(16);</span>
<span class="nc" id="L249">        f.addView(protectedLabel);</span>

<span class="nc" id="L251">        android.widget.Spinner protectedSpinner = new android.widget.Spinner(this);</span>
<span class="nc" id="L252">        String[] protectedOptions = new String[] { &quot;No&quot;, &quot;Yes&quot; };</span>
<span class="nc" id="L253">        android.widget.ArrayAdapter&lt;String&gt; protectedAdapter =</span>
                new android.widget.ArrayAdapter&lt;&gt;(this,
                        android.R.layout.simple_spinner_item,
                        protectedOptions);
<span class="nc" id="L257">        protectedAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span class="nc" id="L258">        protectedSpinner.setAdapter(protectedAdapter);</span>
<span class="nc" id="L259">        protectedSpinner.setPrompt(&quot;Protected status&quot;);</span>
<span class="nc" id="L260">        f.addView(protectedSpinner);</span>

<span class="nc" id="L262">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L263">                .setTitle(&quot;Create Medicine&quot;)</span>
<span class="nc" id="L264">                .setView(f)</span>
<span class="nc" id="L265">                .setPositiveButton(&quot;Create&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L266">                    JSONObject body = new JSONObject();</span>
                    try {
<span class="nc" id="L268">                        body.put(&quot;name&quot;, name.getText().toString().trim());</span>
<span class="nc" id="L269">                        body.put(&quot;genericName&quot;, generic.getText().toString().trim());</span>
<span class="nc" id="L270">                        body.put(&quot;dosage&quot;, dosage.getText().toString().trim());</span>
<span class="nc" id="L271">                        body.put(&quot;priceInCents&quot;, parseIntSafe(price.getText().toString().trim()));</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">                        if (!image.getText().toString().trim().isEmpty()) {</span>
<span class="nc" id="L273">                            body.put(&quot;imageUrl&quot;, image.getText().toString().trim());</span>
                        }

<span class="nc" id="L276">                        boolean isProtected =</span>
<span class="nc" id="L277">                                &quot;Yes&quot;.equalsIgnoreCase(String.valueOf(protectedSpinner.getSelectedItem()));</span>
<span class="nc" id="L278">                        body.put(&quot;isProtected&quot;, isProtected);</span>

<span class="nc" id="L280">                    } catch (JSONException ignored) {}</span>

<span class="nc" id="L282">                    JsonObjectRequest req = new JsonObjectRequest(</span>
                            Request.Method.POST,
                            URL_MED_CREATE,
                            body,
<span class="nc" id="L286">                            resp -&gt; showJson(&quot;Medicine created&quot;, resp.toString()),</span>
<span class="nc" id="L287">                            (VolleyError err) -&gt; showBigMessage(&quot;Error&quot;, err.toString())</span>
                    );
<span class="nc" id="L289">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L290">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L291">                })</span>
<span class="nc" id="L292">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L293">                .show();</span>
<span class="nc" id="L294">    }</span>

    private void promptMedRead() {
<span class="nc" id="L297">        LinearLayout f = formLayout();</span>
<span class="nc" id="L298">        EditText name = addField(f, &quot;Medicine Name (Brand)&quot;, InputType.TYPE_CLASS_TEXT);</span>

<span class="nc" id="L300">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L301">                .setTitle(&quot;Read Medicine&quot;)</span>
<span class="nc" id="L302">                .setView(f)</span>
<span class="nc" id="L303">                .setPositiveButton(&quot;Fetch&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L304">                    String url = URL_MED_READ_BASE + name.getText().toString().trim();</span>

<span class="nc" id="L306">                    JsonObjectRequest req = new JsonObjectRequest(</span>
                            Request.Method.GET,
                            url,
                            null,
<span class="nc" id="L310">                            resp -&gt; showJson(&quot;Medicine&quot;, resp.toString()),</span>
<span class="nc" id="L311">                            (VolleyError err) -&gt; toast(&quot;Read medicine failed&quot;)</span>
                    );
<span class="nc" id="L313">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L314">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L315">                })</span>
<span class="nc" id="L316">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L317">                .show();</span>
<span class="nc" id="L318">    }</span>

    private void promptMedUpdate() {
<span class="nc" id="L321">        LinearLayout f = formLayout();</span>
<span class="nc" id="L322">        EditText id      = addField(f, &quot;Medicine ID&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L323">        EditText name    = addField(f, &quot;New Name (optional)&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L324">        EditText generic = addField(f, &quot;New Generic (optional)&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L325">        EditText dosage  = addField(f, &quot;New Dosage (optional)&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L326">        EditText price   = addField(f, &quot;New Price cents (optional)&quot;, InputType.TYPE_CLASS_NUMBER);</span>
<span class="nc" id="L327">        EditText image   = addField(f, &quot;New Image URL (optional)&quot;, InputType.TYPE_TEXT_VARIATION_URI);</span>

<span class="nc" id="L329">        TextView protectedLabel = new TextView(this);</span>
<span class="nc" id="L330">        protectedLabel.setText(&quot;Protected Status (optional):&quot;);</span>
<span class="nc" id="L331">        protectedLabel.setTextSize(16);</span>
<span class="nc" id="L332">        f.addView(protectedLabel);</span>

<span class="nc" id="L334">        Spinner protectedSpinner = new Spinner(this);</span>
<span class="nc" id="L335">        String[] protectedOptions = new String[]{&quot;No Change&quot;, &quot;No&quot;, &quot;Yes&quot;};</span>
<span class="nc" id="L336">        ArrayAdapter&lt;String&gt; protectedAdapter =</span>
                new ArrayAdapter&lt;&gt;(this,
                        android.R.layout.simple_spinner_item,
                        protectedOptions);
<span class="nc" id="L340">        protectedAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span class="nc" id="L341">        protectedSpinner.setAdapter(protectedAdapter);</span>
<span class="nc" id="L342">        f.addView(protectedSpinner);</span>

<span class="nc" id="L344">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L345">                .setTitle(&quot;Update Medicine&quot;)</span>
<span class="nc" id="L346">                .setView(f)</span>
<span class="nc" id="L347">                .setPositiveButton(&quot;Update&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L348">                    JSONObject body = new JSONObject();</span>
                    try {
<span class="nc bnc" id="L350" title="All 2 branches missed.">                        if (!name.getText().toString().trim().isEmpty())</span>
<span class="nc" id="L351">                            body.put(&quot;name&quot;, name.getText().toString().trim());</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                        if (!generic.getText().toString().trim().isEmpty())</span>
<span class="nc" id="L353">                            body.put(&quot;genericName&quot;, generic.getText().toString().trim());</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                        if (!dosage.getText().toString().trim().isEmpty())</span>
<span class="nc" id="L355">                            body.put(&quot;dosage&quot;, dosage.getText().toString().trim());</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">                        if (!price.getText().toString().trim().isEmpty())</span>
<span class="nc" id="L357">                            body.put(&quot;priceInCents&quot;, parseIntSafe(price.getText().toString().trim()));</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                        if (!image.getText().toString().trim().isEmpty())</span>
<span class="nc" id="L359">                            body.put(&quot;imageUrl&quot;, image.getText().toString().trim());</span>

<span class="nc" id="L361">                        String selected = String.valueOf(protectedSpinner.getSelectedItem());</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">                        if (&quot;Yes&quot;.equalsIgnoreCase(selected)) {</span>
<span class="nc" id="L363">                            body.put(&quot;isProtected&quot;, true);</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">                        } else if (&quot;No&quot;.equalsIgnoreCase(selected)) {</span>
<span class="nc" id="L365">                            body.put(&quot;isProtected&quot;, false);</span>
                        }

<span class="nc" id="L368">                    } catch (JSONException ignored) {}</span>

<span class="nc" id="L370">                    String url = URL_MED_UPDATE_BASE + id.getText().toString().trim();</span>

<span class="nc" id="L372">                    JsonObjectRequest req = new JsonObjectRequest(</span>
                            Request.Method.PUT,
                            url,
                            body,
<span class="nc" id="L376">                            resp -&gt; showJson(&quot;Medicine updated&quot;, resp.toString()),</span>
<span class="nc" id="L377">                            (VolleyError err) -&gt; toast(&quot;Update medicine failed&quot;)</span>
                    );
<span class="nc" id="L379">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L380">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L381">                })</span>
<span class="nc" id="L382">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L383">                .show();</span>
<span class="nc" id="L384">    }</span>

    private void promptMedDelete() {
<span class="nc" id="L387">        LinearLayout f = formLayout();</span>
<span class="nc" id="L388">        EditText id = addField(f, &quot;Medicine ID&quot;, InputType.TYPE_CLASS_TEXT);</span>

<span class="nc" id="L390">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L391">                .setTitle(&quot;Delete Medicine&quot;)</span>
<span class="nc" id="L392">                .setView(f)</span>
<span class="nc" id="L393">                .setPositiveButton(&quot;Delete&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L394">                    String url = URL_MED_DELETE_BASE + id.getText().toString().trim();</span>

<span class="nc" id="L396">                    StringRequest req = new StringRequest(</span>
                            Request.Method.DELETE,
                            url,
<span class="nc" id="L399">                            resp -&gt; toast(&quot;Medicine deleted&quot;),</span>
<span class="nc" id="L400">                            (VolleyError err) -&gt; toast(&quot;Delete medicine failed&quot;)</span>
                    );
<span class="nc" id="L402">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L403">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L404">                })</span>
<span class="nc" id="L405">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L406">                .show();</span>
<span class="nc" id="L407">    }</span>

    private void promptBroadcast() {
<span class="nc" id="L410">        LinearLayout f = formLayout();</span>
<span class="nc" id="L411">        EditText title   = addField(f, &quot;Title&quot;, InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L412">        EditText content = addField(f, &quot;Content&quot;, InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_FLAG_MULTI_LINE);</span>

<span class="nc" id="L414">        new AlertDialog.Builder(this)</span>
<span class="nc" id="L415">                .setTitle(&quot;Broadcast Notification&quot;)</span>
<span class="nc" id="L416">                .setView(f)</span>
<span class="nc" id="L417">                .setPositiveButton(&quot;Send&quot;, (d, w) -&gt; {</span>
<span class="nc" id="L418">                    JSONObject body = new JSONObject();</span>
                    try {
<span class="nc" id="L420">                        body.put(&quot;title&quot;, title.getText().toString().trim());</span>
<span class="nc" id="L421">                        body.put(&quot;content&quot;, content.getText().toString().trim());</span>
<span class="nc" id="L422">                    } catch (JSONException ignored) {}</span>

<span class="nc" id="L424">                    JsonObjectRequest req = new JsonObjectRequest(</span>
                            Request.Method.POST,
                            URL_BROADCAST,
                            body,
<span class="nc" id="L428">                            resp -&gt; toast(resp.toString()),</span>
<span class="nc" id="L429">                            (VolleyError err) -&gt; toast(&quot;Broadcast failed&quot;)</span>
<span class="nc" id="L430">                    ) {</span>
                        @Override
                        public java.util.Map&lt;String, String&gt; getHeaders() {
<span class="nc" id="L433">                            java.util.Map&lt;String, String&gt; h = new java.util.HashMap&lt;&gt;();</span>
<span class="nc" id="L434">                            String access = AuthManager.getAccessToken(getApplicationContext());</span>
<span class="nc bnc" id="L435" title="All 4 branches missed.">                            if (access != null &amp;&amp; !access.isEmpty()) {</span>
<span class="nc" id="L436">                                h.put(&quot;Authorization&quot;, &quot;Bearer &quot; + access);</span>
                            }
<span class="nc" id="L438">                            h.put(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<span class="nc" id="L439">                            h.put(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
<span class="nc" id="L440">                            return h;</span>
                        }
                    };
<span class="nc" id="L443">                    applyDevRetryPolicy(req);</span>
<span class="nc" id="L444">                    VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(req);</span>
<span class="nc" id="L445">                })</span>
<span class="nc" id="L446">                .setNegativeButton(&quot;Cancel&quot;, null)</span>
<span class="nc" id="L447">                .show();</span>
<span class="nc" id="L448">    }</span>


    private int parseIntSafe(String s) {
<span class="nc" id="L452">        try { return Integer.parseInt(s); } catch (Exception e) { return 0; }</span>
    }

    private void showBigMessage(String title, String message) {
        // Pretty safe width and padding
<span class="nc" id="L457">        int pad = (int) (16 * getResources().getDisplayMetrics().density);</span>

<span class="nc" id="L459">        android.widget.ScrollView scroller = new android.widget.ScrollView(this);</span>
<span class="nc" id="L460">        android.widget.TextView tv = new android.widget.TextView(this);</span>
<span class="nc" id="L461">        tv.setTextIsSelectable(true); // allow copy</span>
<span class="nc" id="L462">        tv.setPadding(pad, pad, pad, pad);</span>
<span class="nc" id="L463">        tv.setText(message);</span>
<span class="nc" id="L464">        tv.setTextSize(14);</span>
<span class="nc" id="L465">        tv.setTypeface(android.graphics.Typeface.MONOSPACE); // nice for JSON</span>
<span class="nc" id="L466">        scroller.addView(tv);</span>

<span class="nc" id="L468">        new android.app.AlertDialog.Builder(this)</span>
<span class="nc" id="L469">                .setTitle(title)</span>
<span class="nc" id="L470">                .setView(scroller)</span>
<span class="nc" id="L471">                .setPositiveButton(&quot;OK&quot;, null)</span>
<span class="nc" id="L472">                .show();</span>
<span class="nc" id="L473">    }</span>

    private void showJson(String title, String rawJson) {
<span class="nc" id="L476">        String pretty = rawJson;</span>
        try {
<span class="nc bnc" id="L478" title="All 2 branches missed.">            if (rawJson.trim().startsWith(&quot;{&quot;)) {</span>
<span class="nc" id="L479">                pretty = new org.json.JSONObject(rawJson).toString(2);</span>
<span class="nc bnc" id="L480" title="All 2 branches missed.">            } else if (rawJson.trim().startsWith(&quot;[&quot;)) {</span>
<span class="nc" id="L481">                pretty = new org.json.JSONArray(rawJson).toString(2);</span>
            }
<span class="nc" id="L483">        } catch (Exception ignored) {}</span>
<span class="nc" id="L484">        showBigMessage(title, pretty);</span>
<span class="nc" id="L485">    }</span>

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span>Generated by the Android Gradle plugin 8.13.0</div></body></html>